<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>iCapital</title>
    <link href="../output.css" rel="stylesheet" />
</head>

<body class="bg-gray-100 text-gray-800">
    <div class="max-w-2xl mx-auto p-6 bg-white shadow-md rounded-lg mt-10">
        <h1 class="text-2xl font-bold mb-6 text-center">{{caption}}</h1>
        <form id="add-entry-form" class="space-y-4" enctype="multipart/form-data">
            <div>
                <label for="firstName" class="block text-sm font-medium text-gray-700">Investor First Name:</label>
                <input type="text" id="firstName" name="firstName" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="lastName" class="block text-sm font-medium text-gray-700">Investor Last Name:</label>
                <input type="text" id="lastName" name="lastName" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="dob" class="block text-sm font-medium text-gray-700">Investor Date of Birth:</label>
                <input type="date" id="dob" name="dob" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="phoneNumber" class="block text-sm font-medium text-gray-700">Investor Phone Number:</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="street" class="block text-sm font-medium text-gray-700">Investor Street Address:</label>
                <input type="text" id="street" name="street" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="state" class="block text-sm font-medium text-gray-700">Investor State:</label>
                <select id="state" name="state" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="" disabled selected>Select your state</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>
            <div>
                <label for="zip" class="block text-sm font-medium text-gray-700">Investor Zip Code:</label>
                <input type="text" id="zip" name="zip" pattern="\d{5}" title="Please enter a valid 5-digit zip code"
                    required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="ssn" class="block text-sm font-medium text-gray-700">Investor SSN:</label>
                <input type="text" id="ssn" name="ssn" pattern="\d{3}-\d{2}-\d{4}"
                    title="Please enter a valid SSN in the format XXX-XX-XXXX" required
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div>
                <label for="file" class="block text-sm font-medium text-gray-700">Upload Supporting
                    Document:</label>
                <input type="file" id="file" name="file"
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
            </div>
            <div class="flex space-x-4 w-full ">
                <progress id="uploadProgress" value="0" max="100" class="w-4/5 h-4 bg-white-200 border "></progress>
                <span id="progressText" class="w-1/5 h-4 text-gray-600 text-right"></span>
            </div>
            <div class="text-center">
                <button type="submit"
                    class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Submit</button>
            </div>
        </form>

    </div>

    <script>
        document.getElementById("add-entry-form").addEventListener('submit', function (event) {
            event.preventDefault()
            const fileInput = document.getElementById("file")
            const file = fileInput.files[0]
            const maxSize = 3 * 164 * 1064 // Max file size 3 MB
            if (file.size > maxSize) {
                alert("Uploade file should not exceed 3MB")
                console.error("File size is larger than 3MB")
                return
            }
            const formData = new FormData()
            const uploadProgress = document.getElementById('uploadProgress');
            const progressText = document.getElementById('progressText');
            formData.append('file', file)
            const formElements = document.getElementById("add-entry-form").elements;
            for (let i = 0; i < formElements.length; i++) {
                const element = formElements[i];
                if (element.name && element.type !== 'file') {
                    formData.append(element.name, element.value);
                }
            }
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/add-entry', true)
            xhr.upload.addEventListener('progress', function (e) {
                if (e.lengthComputable) { // Update progress
                    const percentComplete = (e.loaded / e.total) * 100;
                    uploadProgress.value = percentComplete;
                    progressText.textContent = Math.round(percentComplete) + '% uploaded';
                }
            });
            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status <= 299) {
                    document.getElementById("add-entry-form").reset();
                    alert("Form submitted successfully. Investor's information recorded into the system.");
                    const uploadProgress = document.getElementById('uploadProgress');
                    const progressText = document.getElementById('progressText');
                    uploadProgress.value = 0;
                    progressText.textContent = ""

                } else {
                    alert('Upload failed: ', xhr.statusText)
                    console.error('Upload failed: ', xhr.statusText)
                }
            }
            xhr.send(formData)
        })
    </script>
</body>
</div>

</html>